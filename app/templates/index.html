{% extends "base.html" %}

{% block title %}Medical Lung Classification{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="card border border-2 border-dark shadow-sm mb-4">
        <!-- Header Section -->
        <header class="text-center mt-4">
            <h1>Medical Lung Status Classification</h1>
            <p>Upload a chest X-ray image to classify the lung status using our advanced machine learning model.</p>
        </header>

        <!-- File Upload Section -->
        <div class="file-input-container m-4">
            <input type="file" id="fileInput">
            <span class="file-input-text">Choose File</span>
        </div>
        
        <!-- Classify Button -->
        <div class="text-center mb-4">
            <button class="btn btn-custom" id="classifyButton">Classify</button>
        </div>
        <div class="overlay" id="overlay"></div>
        <div class="iframe-container" id="iframeContainer">
            <!-- Embedded animation code goes here -->
            <iframe src="https://lottie.host/embed/4eb023f3-51de-420e-bef9-9ee6edccfced/OLMBQW7x9z.json"></iframe>
        </div>
    </div>
    <div class="card border border-2 border-dark shadow-sm">
        <!-- Information Section -->
        <section class="info-section ml-4 mr-4 mb-4">
            <h3>How It Works</h3>
            <p>
                Our system uses a deep learning model trained on thousands of lung X-ray images to classify the lung status. 
                Once you upload an image, it will be analyzed and classified as either normal or indicative of a medical condition.
            </p>
        </section>
    </div>
    <!--
    <div class="card border border-2 border-dark shadow-sm mt-4">
        <Results Section>
        <section class="results-section p-4" id="resultsSection">
            <h3>Results</h3>
            <div id="resultsContainer" class="mt-3">
                <Results will be displayed here>
            </div>
        </section>
    </div>
    -->
</div>

{% include "footer.html" %}

<!-- Bootstrap JS and dependencies -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
    document.getElementById('fileInput').addEventListener('change', function() {
        var fileName = this.files[0].name;
        var nextSibling = this.nextElementSibling;
        nextSibling.innerText = fileName;
    });

    document.getElementById('classifyButton').addEventListener('click', function() {
        var fileInput = document.getElementById('fileInput');
        if (fileInput.files.length === 0) {
            alert('Please select a file first.');
            return;
        }

        var formData = new FormData();
        formData.append('file', fileInput.files[0]);

        // Show overlay and iframe container
        document.getElementById('overlay').style.display = 'block';
        document.getElementById('iframeContainer').style.display = 'block';

        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/classify', true);
        xhr.onload = function () {
            if (xhr.status === 200) {
                // Hide overlay and iframe container upon success
                document.getElementById('overlay').style.display = 'none';
                document.getElementById('iframeContainer').style.display = 'none';

                var result = JSON.parse(xhr.responseText);

                // Redirect to another page upon success
                window.location.href = '/output';  // Replace '/success' with your actual success page URL
            } else {
                // Hide overlay and iframe container upon error
                document.getElementById('overlay').style.display = 'none';
                document.getElementById('iframeContainer').style.display = 'none';
                alert('Error occurred while classifying the file.');
            }
        };
        xhr.onerror = function () {
            // Hide overlay and iframe container upon error
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('iframeContainer').style.display = 'none';
            alert('Error occurred while classifying the file.');
        };
        xhr.send(formData);
    });
</script>
{% endblock %}
